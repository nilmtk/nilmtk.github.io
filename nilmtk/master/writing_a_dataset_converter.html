<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Writing a dataset converter &mdash; NILMTK 0.2-beta documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2-beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="NILMTK 0.2-beta documentation" href="index.html" />
    <link rel="next" title="nilmtk package" href="nilmtk.html" />
    <link rel="prev" title="Contributing" href="contribute.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          NILMTK</a>
        <span class="navbar-text navbar-version pull-left"><b>0.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://github.com/nilmtk/nilmtk">github</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contributing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Writing a dataset converter</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="nilmtk.html">nilmtk package</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Writing a dataset converter</a><ul>
<li><a class="reference internal" href="#time-series-data">Time series data</a><ul>
<li><a class="reference internal" href="#table-location-keys">Table location (keys)</a></li>
<li><a class="reference internal" href="#contents-of-each-table">Contents of each table</a><ul>
<li><a class="reference internal" href="#illustration">Illustration</a></li>
<li><a class="reference internal" href="#index-column">Index column</a></li>
<li><a class="reference internal" href="#measurement-columns">Measurement columns</a></li>
<li><a class="reference internal" href="#column-labels">Column labels</a></li>
<li><a class="reference internal" href="#compression">Compression</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#metadata">Metadata</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="contribute.html" title="Previous Chapter: Contributing"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Contributing</span>
    </a>
  </li>
  <li>
    <a href="nilmtk.html" title="Next Chapter: nilmtk package"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">nilmtk package &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/writing_a_dataset_converter.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="writing-a-dataset-converter">
<h1>Writing a dataset converter<a class="headerlink" href="#writing-a-dataset-converter" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="http://www.hdfgroup.org/HDF5">HDF5 file format</a> is developed by
The HDF Group.  It is an open, binary file format with good support in
a number of programming languages including Python.  In principal, you
could use any language to create your dataset converter but we would
recommend the Python language and we have not tried writing converters
in another other language.  Working with HDF5 files is really easy in
Python using <a class="reference external" href="http://pandas.pydata.org/">Pandas</a> (which, in turn,
uses the excellent <a class="reference external" href="http://www.pytables.org">PyTables</a> package).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you haven&#8217;t done so already, then it might be worth reading the
<a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/io.html#hdf5-pytables">Pandas tutorial on working with HDF5 files in Pandas</a>.</p>
</div>
<p>If you would like to contribute a new dataset converter (or just
better understand the existing converters) then the best way to get up
to speed is probably to read this document first.  This document
explains the layout of data in a NILMTK HDF5 file. Then take a look at
the REDD converter for NILMTK (in
<tt class="docutils literal"><span class="pre">nilmtk/nilmtk/dataset_converters/redd</span></tt>).</p>
<p>NILMTK dataset converters output an HDF5 file which contains both the
time series data from each meter as well as all relevant metadata.</p>
<div class="section" id="time-series-data">
<h2>Time series data<a class="headerlink" href="#time-series-data" title="Permalink to this headline">¶</a></h2>
<p>Data from each physical meter is stored in its own table (i.e. there
is a one-to-one relationship between tables in the HDF5 file and
physical meters).</p>
<div class="section" id="table-location-keys">
<h3>Table location (keys)<a class="headerlink" href="#table-location-keys" title="Permalink to this headline">¶</a></h3>
<p>Tables in HDF5 are identified by a hierarchical key.  Each key is a
string. Levels in the hierarchy are separated by a <tt class="docutils literal"><span class="pre">/</span></tt> character in
the key.  NILMTK uses keys in the form <tt class="docutils literal"><span class="pre">/building&lt;i&gt;/elec/meter&lt;j&gt;</span></tt>
where <tt class="docutils literal"><span class="pre">i</span></tt> and <tt class="docutils literal"><span class="pre">j</span></tt> are integers starting from 1.  <tt class="docutils literal"><span class="pre">i</span></tt> is the
building instance and <tt class="docutils literal"><span class="pre">j</span></tt> is the meter instance.  For example, the
table storing data from meter instance 1 in building instance 1 would
have the key <tt class="docutils literal"><span class="pre">/building1/elec/meter1</span></tt>.  (We use <tt class="docutils literal"><span class="pre">elec</span></tt> in the
hierarchy to allow us, in the future, to add support for other sensor
types like water and gas meters).</p>
</div>
<div class="section" id="contents-of-each-table">
<h3>Contents of each table<a class="headerlink" href="#contents-of-each-table" title="Permalink to this headline">¶</a></h3>
<div class="section" id="illustration">
<h4>Illustration<a class="headerlink" href="#illustration" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="20%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" rowspan="2">&nbsp;</th>
<th class="head">power</th>
<th class="head">energy</th>
<th class="head">voltage</th>
</tr>
<tr class="row-even"><th class="head">active</th>
<th class="head">reactive</th>
<th class="head">&nbsp;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-odd"><td>2014-07-01T05:00:14+00:00</td>
<td>0.1</td>
<td>0.01</td>
<td>231.1</td>
</tr>
<tr class="row-even"><td>2014-07-01T05:00:15+00:00</td>
<td>100.5</td>
<td>10.5</td>
<td>232.1</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="index-column">
<h4>Index column<a class="headerlink" href="#index-column" title="Permalink to this headline">¶</a></h4>
<p>The index column is a datetime represented on disk as a nano-second
precision (!) UNIX timestamp stored as an unsigned 64-bit int.  In
Python, we used a timezone-aware <tt class="docutils literal"><span class="pre">numpy.datetime64</span></tt>.</p>
</div>
<div class="section" id="measurement-columns">
<h4>Measurement columns<a class="headerlink" href="#measurement-columns" title="Permalink to this headline">¶</a></h4>
<p>Every column apart from the index column holds a measurement taken by
the meter. These measurements could be power demand, energy,
cumulative energy, voltage or current. Each measurement is
represented as 32-bit floating point number.</p>
<p>We always use SI units or SI derived units and NILMTK assumes that no
unit prefix (e.g. &#8216;kilo-&#8216; or &#8216;mega-&#8216;) has been applied.  In other
words, NILMTK assumes a unit multiplier of 1.  For example, we always
use watts (not kW) for active power.  If the source dataset uses, say,
kW then please multiply these values by 1000 in your converter.</p>
</div>
<div class="section" id="column-labels">
<h4>Column labels<a class="headerlink" href="#column-labels" title="Permalink to this headline">¶</a></h4>
<p>Column labels are hierarchical with 2 levels (<a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/indexing.html#hierarchical-indexing-multiindex">hierarchical labels are
very well supported by Pandas</a>).
The top level describes the <tt class="docutils literal"><span class="pre">physical_quantity</span></tt> being measured.  The
seconds level describes the <tt class="docutils literal"><span class="pre">type</span></tt> which, at present, is used for
energy and power columns to describe whether the alternating current
measurement is <tt class="docutils literal"><span class="pre">apparent</span></tt>, <tt class="docutils literal"><span class="pre">active</span></tt> or <tt class="docutils literal"><span class="pre">reactive</span></tt>.  We use a
controlled vocabulary for both <tt class="docutils literal"><span class="pre">physical_quanitity</span></tt> and <tt class="docutils literal"><span class="pre">type</span></tt>.
For the full details of this controlled vocabulary, please see the
documentation for <tt class="docutils literal"><span class="pre">physical_quantity</span></tt> and <tt class="docutils literal"><span class="pre">type</span></tt> under the
<tt class="docutils literal"><span class="pre">measurements</span></tt> property for the <a class="reference external" href="http://nilm-metadata.readthedocs.org/en/latest/dataset_metadata.html#meterdevice">MeterDevice object in NILM Metadata</a>.</p>
</div>
<div class="section" id="compression">
<h4>Compression<a class="headerlink" href="#compression" title="Permalink to this headline">¶</a></h4>
<p>We use <tt class="docutils literal"><span class="pre">zlib</span></tt> to compress our HDF5 files.  <tt class="docutils literal"><span class="pre">bzip2</span></tt> results in
slightly smaller files (261MB for <tt class="docutils literal"><span class="pre">bzip2</span></tt> versus 273MB for <tt class="docutils literal"><span class="pre">zlip</span></tt>
for REDD) but doesn&#8217;t appear to be compatible with <a class="reference external" href="http://www.hdfgroup.org/products/java/release/download.html">HDFView</a>.</p>
</div>
</div>
</div>
<div class="section" id="metadata">
<h2>Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h2>
<p>In order for NILMTK to be able to load the dataset, we need to add
metadata to the HDF5 file.  NILMTK uses the <a class="reference external" href="https://github.com/nilmtk/nilm_metadata">NILM Metadata schema</a>.</p>
<p>If the dataset is already described in YAML using the NILM Metadata
schema then just call <tt class="docutils literal"><span class="pre">nilm_metadata.convert_yaml_to_hdf5()</span></tt>.</p>
<p>If the dataset is not already described using the NILM Metadata schema
then it will be necessary to do so.  If it is a small dataset then you
could manually write the YAML files and then convert these to HDF5
(this is how our REDD converter works).  If it is a large dataset then
it would be better to programmatically convert the dataset&#8217;s own
metadata to NILM Metadata and store the metadata directly in the HDF5
file.  For an introduction to NILM Metadata first read the <a class="reference external" href="https://github.com/nilmtk/nilm_metadata/blob/master/README.md">README</a> and
then <a class="reference external" href="http://nilm-metadata.readthedocs.org/en/latest/tutorial.html">the tutorial</a> and
finally refer to <a class="reference external" href="http://nilm-metadata.readthedocs.org/en/latest/dataset_metadata.html">the dataset_metadata doc page</a>
for the full description of the metadata schema.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, NILMTK Authors.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>